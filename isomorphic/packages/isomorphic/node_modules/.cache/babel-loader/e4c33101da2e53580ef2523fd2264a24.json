{"ast":null,"code":"'use strict';\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar qsStringify = require('qs-stringify');\n\nvar URL = require('url-parse');\n\nvar RequestClient = require('./RequestClient');\n\nvar tokenStorage = require('./tokenStorage');\n\nvar _getName = function _getName(id) {\n  return id.split('-').map(function (s) {\n    return s.charAt(0).toUpperCase() + s.slice(1);\n  }).join(' ');\n};\n\nmodule.exports = /*#__PURE__*/function (_RequestClient) {\n  _inheritsLoose(Provider, _RequestClient);\n\n  function Provider(uppy, opts) {\n    var _this;\n\n    _this = _RequestClient.call(this, uppy, opts) || this;\n    _this.provider = opts.provider;\n    _this.id = _this.provider;\n    _this.name = _this.opts.name || _getName(_this.id);\n    _this.pluginId = _this.opts.pluginId;\n    _this.tokenKey = \"companion-\" + _this.pluginId + \"-auth-token\";\n    _this.companionKeysParams = _this.opts.companionKeysParams;\n    _this.preAuthToken = null;\n    return _this;\n  }\n\n  var _proto = Provider.prototype;\n\n  _proto.headers = function headers() {\n    var _this2 = this;\n\n    return Promise.all([_RequestClient.prototype.headers.call(this), this.getAuthToken()]).then(function (_ref) {\n      var headers = _ref[0],\n          token = _ref[1];\n      var authHeaders = {};\n\n      if (token) {\n        authHeaders['uppy-auth-token'] = token;\n      }\n\n      if (_this2.companionKeysParams) {\n        authHeaders['uppy-credentials-params'] = btoa(JSON.stringify({\n          params: _this2.companionKeysParams\n        }));\n      }\n\n      return _extends({}, headers, authHeaders);\n    });\n  };\n\n  _proto.onReceiveResponse = function onReceiveResponse(response) {\n    response = _RequestClient.prototype.onReceiveResponse.call(this, response);\n    var plugin = this.uppy.getPlugin(this.pluginId);\n    var oldAuthenticated = plugin.getPluginState().authenticated;\n    var authenticated = oldAuthenticated ? response.status !== 401 : response.status < 400;\n    plugin.setPluginState({\n      authenticated: authenticated\n    });\n    return response;\n  } // @todo(i.olarewaju) consider whether or not this method should be exposed\n  ;\n\n  _proto.setAuthToken = function setAuthToken(token) {\n    return this.uppy.getPlugin(this.pluginId).storage.setItem(this.tokenKey, token);\n  };\n\n  _proto.getAuthToken = function getAuthToken() {\n    return this.uppy.getPlugin(this.pluginId).storage.getItem(this.tokenKey);\n  };\n\n  _proto.authUrl = function authUrl(queries) {\n    if (queries === void 0) {\n      queries = {};\n    }\n\n    if (this.preAuthToken) {\n      queries.uppyPreAuthToken = this.preAuthToken;\n    }\n\n    var strigifiedQueries = qsStringify(queries);\n    strigifiedQueries = strigifiedQueries ? \"?\" + strigifiedQueries : strigifiedQueries;\n    return this.hostname + \"/\" + this.id + \"/connect\" + strigifiedQueries;\n  };\n\n  _proto.fileUrl = function fileUrl(id) {\n    return this.hostname + \"/\" + this.id + \"/get/\" + id;\n  };\n\n  _proto.fetchPreAuthToken = function fetchPreAuthToken() {\n    var _this3 = this;\n\n    if (!this.companionKeysParams) {\n      return Promise.resolve();\n    }\n\n    return this.post(this.id + \"/preauth/\", {\n      params: this.companionKeysParams\n    }).then(function (res) {\n      _this3.preAuthToken = res.token;\n    }).catch(function (err) {\n      _this3.uppy.log(\"[CompanionClient] unable to fetch preAuthToken \" + err, 'warning');\n    });\n  };\n\n  _proto.list = function list(directory) {\n    return this.get(this.id + \"/list/\" + (directory || ''));\n  };\n\n  _proto.logout = function logout() {\n    var _this4 = this;\n\n    return this.get(this.id + \"/logout\").then(function (response) {\n      return Promise.all([response, _this4.uppy.getPlugin(_this4.pluginId).storage.removeItem(_this4.tokenKey)]);\n    }).then(function (_ref2) {\n      var response = _ref2[0];\n      return response;\n    });\n  };\n\n  Provider.initPlugin = function initPlugin(plugin, opts, defaultOpts) {\n    plugin.type = 'acquirer';\n    plugin.files = [];\n\n    if (defaultOpts) {\n      plugin.opts = _extends({}, defaultOpts, opts);\n    }\n\n    if (opts.serverUrl || opts.serverPattern) {\n      throw new Error('`serverUrl` and `serverPattern` have been renamed to `companionUrl` and `companionAllowedHosts` respectively in the 0.30.5 release. Please consult the docs (for example, https://uppy.io/docs/instagram/ for the Instagram plugin) and use the updated options.`');\n    }\n\n    if (opts.companionAllowedHosts) {\n      var pattern = opts.companionAllowedHosts; // validate companionAllowedHosts param\n\n      if (typeof pattern !== 'string' && !Array.isArray(pattern) && !(pattern instanceof RegExp)) {\n        throw new TypeError(plugin.id + \": the option \\\"companionAllowedHosts\\\" must be one of string, Array, RegExp\");\n      }\n\n      plugin.opts.companionAllowedHosts = pattern;\n    } else {\n      // does not start with https://\n      if (/^(?!https?:\\/\\/).*$/i.test(opts.companionUrl)) {\n        plugin.opts.companionAllowedHosts = \"https://\" + opts.companionUrl.replace(/^\\/\\//, '');\n      } else {\n        plugin.opts.companionAllowedHosts = new URL(opts.companionUrl).origin;\n      }\n    }\n\n    plugin.storage = plugin.opts.storage || tokenStorage;\n  };\n\n  return Provider;\n}(RequestClient);","map":{"version":3,"sources":["D:/TT18-EC-Team1-FE/isomorphic/node_modules/@uppy/companion-client/lib/Provider.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_inheritsLoose","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","qsStringify","require","URL","RequestClient","tokenStorage","_getName","id","split","map","s","charAt","toUpperCase","slice","join","module","exports","_RequestClient","Provider","uppy","opts","_this","provider","name","pluginId","tokenKey","companionKeysParams","preAuthToken","_proto","headers","_this2","Promise","all","getAuthToken","then","_ref","token","authHeaders","btoa","JSON","stringify","params","onReceiveResponse","response","plugin","getPlugin","oldAuthenticated","getPluginState","authenticated","status","setPluginState","setAuthToken","storage","setItem","getItem","authUrl","queries","uppyPreAuthToken","strigifiedQueries","hostname","fileUrl","fetchPreAuthToken","_this3","resolve","post","res","catch","err","log","list","directory","get","logout","_this4","removeItem","_ref2","initPlugin","defaultOpts","type","files","serverUrl","serverPattern","Error","companionAllowedHosts","pattern","Array","isArray","RegExp","TypeError","test","companionUrl","replace","origin"],"mappings":"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","sourcesContent":["'use strict';\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nvar qsStringify = require('qs-stringify');\n\nvar URL = require('url-parse');\n\nvar RequestClient = require('./RequestClient');\n\nvar tokenStorage = require('./tokenStorage');\n\nvar _getName = function _getName(id) {\n  return id.split('-').map(function (s) {\n    return s.charAt(0).toUpperCase() + s.slice(1);\n  }).join(' ');\n};\n\nmodule.exports = /*#__PURE__*/function (_RequestClient) {\n  _inheritsLoose(Provider, _RequestClient);\n\n  function Provider(uppy, opts) {\n    var _this;\n\n    _this = _RequestClient.call(this, uppy, opts) || this;\n    _this.provider = opts.provider;\n    _this.id = _this.provider;\n    _this.name = _this.opts.name || _getName(_this.id);\n    _this.pluginId = _this.opts.pluginId;\n    _this.tokenKey = \"companion-\" + _this.pluginId + \"-auth-token\";\n    _this.companionKeysParams = _this.opts.companionKeysParams;\n    _this.preAuthToken = null;\n    return _this;\n  }\n\n  var _proto = Provider.prototype;\n\n  _proto.headers = function headers() {\n    var _this2 = this;\n\n    return Promise.all([_RequestClient.prototype.headers.call(this), this.getAuthToken()]).then(function (_ref) {\n      var headers = _ref[0],\n          token = _ref[1];\n      var authHeaders = {};\n\n      if (token) {\n        authHeaders['uppy-auth-token'] = token;\n      }\n\n      if (_this2.companionKeysParams) {\n        authHeaders['uppy-credentials-params'] = btoa(JSON.stringify({\n          params: _this2.companionKeysParams\n        }));\n      }\n\n      return _extends({}, headers, authHeaders);\n    });\n  };\n\n  _proto.onReceiveResponse = function onReceiveResponse(response) {\n    response = _RequestClient.prototype.onReceiveResponse.call(this, response);\n    var plugin = this.uppy.getPlugin(this.pluginId);\n    var oldAuthenticated = plugin.getPluginState().authenticated;\n    var authenticated = oldAuthenticated ? response.status !== 401 : response.status < 400;\n    plugin.setPluginState({\n      authenticated: authenticated\n    });\n    return response;\n  } // @todo(i.olarewaju) consider whether or not this method should be exposed\n  ;\n\n  _proto.setAuthToken = function setAuthToken(token) {\n    return this.uppy.getPlugin(this.pluginId).storage.setItem(this.tokenKey, token);\n  };\n\n  _proto.getAuthToken = function getAuthToken() {\n    return this.uppy.getPlugin(this.pluginId).storage.getItem(this.tokenKey);\n  };\n\n  _proto.authUrl = function authUrl(queries) {\n    if (queries === void 0) {\n      queries = {};\n    }\n\n    if (this.preAuthToken) {\n      queries.uppyPreAuthToken = this.preAuthToken;\n    }\n\n    var strigifiedQueries = qsStringify(queries);\n    strigifiedQueries = strigifiedQueries ? \"?\" + strigifiedQueries : strigifiedQueries;\n    return this.hostname + \"/\" + this.id + \"/connect\" + strigifiedQueries;\n  };\n\n  _proto.fileUrl = function fileUrl(id) {\n    return this.hostname + \"/\" + this.id + \"/get/\" + id;\n  };\n\n  _proto.fetchPreAuthToken = function fetchPreAuthToken() {\n    var _this3 = this;\n\n    if (!this.companionKeysParams) {\n      return Promise.resolve();\n    }\n\n    return this.post(this.id + \"/preauth/\", {\n      params: this.companionKeysParams\n    }).then(function (res) {\n      _this3.preAuthToken = res.token;\n    }).catch(function (err) {\n      _this3.uppy.log(\"[CompanionClient] unable to fetch preAuthToken \" + err, 'warning');\n    });\n  };\n\n  _proto.list = function list(directory) {\n    return this.get(this.id + \"/list/\" + (directory || ''));\n  };\n\n  _proto.logout = function logout() {\n    var _this4 = this;\n\n    return this.get(this.id + \"/logout\").then(function (response) {\n      return Promise.all([response, _this4.uppy.getPlugin(_this4.pluginId).storage.removeItem(_this4.tokenKey)]);\n    }).then(function (_ref2) {\n      var response = _ref2[0];\n      return response;\n    });\n  };\n\n  Provider.initPlugin = function initPlugin(plugin, opts, defaultOpts) {\n    plugin.type = 'acquirer';\n    plugin.files = [];\n\n    if (defaultOpts) {\n      plugin.opts = _extends({}, defaultOpts, opts);\n    }\n\n    if (opts.serverUrl || opts.serverPattern) {\n      throw new Error('`serverUrl` and `serverPattern` have been renamed to `companionUrl` and `companionAllowedHosts` respectively in the 0.30.5 release. Please consult the docs (for example, https://uppy.io/docs/instagram/ for the Instagram plugin) and use the updated options.`');\n    }\n\n    if (opts.companionAllowedHosts) {\n      var pattern = opts.companionAllowedHosts; // validate companionAllowedHosts param\n\n      if (typeof pattern !== 'string' && !Array.isArray(pattern) && !(pattern instanceof RegExp)) {\n        throw new TypeError(plugin.id + \": the option \\\"companionAllowedHosts\\\" must be one of string, Array, RegExp\");\n      }\n\n      plugin.opts.companionAllowedHosts = pattern;\n    } else {\n      // does not start with https://\n      if (/^(?!https?:\\/\\/).*$/i.test(opts.companionUrl)) {\n        plugin.opts.companionAllowedHosts = \"https://\" + opts.companionUrl.replace(/^\\/\\//, '');\n      } else {\n        plugin.opts.companionAllowedHosts = new URL(opts.companionUrl).origin;\n      }\n    }\n\n    plugin.storage = plugin.opts.storage || tokenStorage;\n  };\n\n  return Provider;\n}(RequestClient);"]},"metadata":{},"sourceType":"script"}