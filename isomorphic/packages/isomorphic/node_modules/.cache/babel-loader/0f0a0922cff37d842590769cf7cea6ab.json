{"ast":null,"code":"var _class, _temp;\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nvar _require = require('preact'),\n    h = _require.h;\n\nvar AuthView = require('./AuthView');\n\nvar Header = require('./Header');\n\nvar Browser = require('../Browser');\n\nvar LoaderView = require('../Loader');\n\nvar generateFileID = require('@uppy/utils/lib/generateFileID');\n\nvar getFileType = require('@uppy/utils/lib/getFileType');\n\nvar findIndex = require('@uppy/utils/lib/findIndex');\n\nvar isPreviewSupported = require('@uppy/utils/lib/isPreviewSupported');\n\nvar SharedHandler = require('../SharedHandler');\n\nvar CloseWrapper = require('../CloseWrapper'); // location.origin does not exist in IE\n\n\nfunction getOrigin() {\n  if ('origin' in location) {\n    return location.origin; // eslint-disable-line compat/compat\n  }\n\n  return location.protocol + \"//\" + location.hostname + (location.port ? \":\" + location.port : '');\n}\n/**\n * Class to easily generate generic views for Provider plugins\n */\n\n\nmodule.exports = (_temp = _class = /*#__PURE__*/function () {\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  function ProviderView(plugin, opts) {\n    this.plugin = plugin;\n    this.provider = opts.provider;\n    this._sharedHandler = new SharedHandler(plugin); // set default options\n\n    var defaultOptions = {\n      viewType: 'list',\n      showTitles: true,\n      showFilter: true,\n      showBreadcrumbs: true\n    }; // merge default options with the ones set by user\n\n    this.opts = _extends({}, defaultOptions, opts); // Logic\n\n    this.addFile = this.addFile.bind(this);\n    this.filterQuery = this.filterQuery.bind(this);\n    this.getFolder = this.getFolder.bind(this);\n    this.getNextFolder = this.getNextFolder.bind(this);\n    this.logout = this.logout.bind(this);\n    this.preFirstRender = this.preFirstRender.bind(this);\n    this.handleAuth = this.handleAuth.bind(this);\n    this.sortByTitle = this.sortByTitle.bind(this);\n    this.sortByDate = this.sortByDate.bind(this);\n    this.handleError = this.handleError.bind(this);\n    this.handleScroll = this.handleScroll.bind(this);\n    this.listAllFiles = this.listAllFiles.bind(this);\n    this.donePicking = this.donePicking.bind(this);\n    this.cancelPicking = this.cancelPicking.bind(this);\n    this.clearSelection = this.clearSelection.bind(this); // Visual\n\n    this.render = this.render.bind(this);\n    this.clearSelection(); // Set default state for the plugin\n\n    this.plugin.setPluginState({\n      authenticated: false,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      isSearchVisible: false\n    });\n  }\n\n  var _proto = ProviderView.prototype;\n\n  _proto.tearDown = function tearDown() {// Nothing.\n  };\n\n  _proto._updateFilesAndFolders = function _updateFilesAndFolders(res, files, folders) {\n    this.nextPagePath = res.nextPagePath;\n    res.items.forEach(function (item) {\n      if (item.isFolder) {\n        folders.push(item);\n      } else {\n        files.push(item);\n      }\n    });\n    this.plugin.setPluginState({\n      folders: folders,\n      files: files\n    });\n  }\n  /**\n   * Called only the first time the provider view is rendered.\n   * Kind of like an init function.\n   */\n  ;\n\n  _proto.preFirstRender = function preFirstRender() {\n    this.plugin.setPluginState({\n      didFirstRender: true\n    });\n    this.plugin.onFirstRender();\n  }\n  /**\n   * Based on folder ID, fetch a new folder and update it to state\n   *\n   * @param  {string} id Folder id\n   * @returns {Promise}   Folders/files in folder\n   */\n  ;\n\n  _proto.getFolder = function getFolder(id, name) {\n    var _this = this;\n\n    return this._sharedHandler.loaderWrapper(this.provider.list(id), function (res) {\n      var folders = [];\n      var files = [];\n      var updatedDirectories;\n\n      var state = _this.plugin.getPluginState();\n\n      var index = findIndex(state.directories, function (dir) {\n        return id === dir.id;\n      });\n\n      if (index !== -1) {\n        updatedDirectories = state.directories.slice(0, index + 1);\n      } else {\n        updatedDirectories = state.directories.concat([{\n          id: id,\n          title: name\n        }]);\n      }\n\n      _this.username = res.username || _this.username;\n\n      _this._updateFilesAndFolders(res, files, folders);\n\n      _this.plugin.setPluginState({\n        directories: updatedDirectories\n      });\n    }, this.handleError);\n  }\n  /**\n   * Fetches new folder\n   *\n   * @param  {object} folder\n   */\n  ;\n\n  _proto.getNextFolder = function getNextFolder(folder) {\n    this.getFolder(folder.requestPath, folder.name);\n    this.lastCheckbox = undefined;\n  };\n\n  _proto.addFile = function addFile(file) {\n    var tagFile = {\n      id: this.providerFileToId(file),\n      source: this.plugin.id,\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType,\n      isRemote: true,\n      body: {\n        fileId: file.id\n      },\n      remote: {\n        companionUrl: this.plugin.opts.companionUrl,\n        url: \"\" + this.provider.fileUrl(file.requestPath),\n        body: {\n          fileId: file.id\n        },\n        providerOptions: this.provider.opts\n      }\n    };\n    var fileType = getFileType(tagFile); // TODO Should we just always use the thumbnail URL if it exists?\n\n    if (fileType && isPreviewSupported(fileType)) {\n      tagFile.preview = file.thumbnail;\n    }\n\n    this.plugin.uppy.log('Adding remote file');\n\n    try {\n      this.plugin.uppy.addFile(tagFile);\n      return true;\n    } catch (err) {\n      if (!err.isRestriction) {\n        this.plugin.uppy.log(err);\n      }\n\n      return false;\n    }\n  }\n  /**\n   * Removes session token on client side.\n   */\n  ;\n\n  _proto.logout = function logout() {\n    var _this2 = this;\n\n    this.provider.logout().then(function (res) {\n      if (res.ok) {\n        if (!res.revoked) {\n          var message = _this2.plugin.uppy.i18n('companionUnauthorizeHint', {\n            provider: _this2.plugin.title,\n            url: res.manual_revoke_url\n          });\n\n          _this2.plugin.uppy.info(message, 'info', 7000);\n        }\n\n        var newState = {\n          authenticated: false,\n          files: [],\n          folders: [],\n          directories: []\n        };\n\n        _this2.plugin.setPluginState(newState);\n      }\n    }).catch(this.handleError);\n  };\n\n  _proto.filterQuery = function filterQuery(e) {\n    var state = this.plugin.getPluginState();\n    this.plugin.setPluginState(_extends({}, state, {\n      filterInput: e ? e.target.value : ''\n    }));\n  };\n\n  _proto.sortByTitle = function sortByTitle() {\n    var state = _extends({}, this.plugin.getPluginState());\n\n    var files = state.files,\n        folders = state.folders,\n        sorting = state.sorting;\n    var sortedFiles = files.sort(function (fileA, fileB) {\n      if (sorting === 'titleDescending') {\n        return fileB.name.localeCompare(fileA.name);\n      }\n\n      return fileA.name.localeCompare(fileB.name);\n    });\n    var sortedFolders = folders.sort(function (folderA, folderB) {\n      if (sorting === 'titleDescending') {\n        return folderB.name.localeCompare(folderA.name);\n      }\n\n      return folderA.name.localeCompare(folderB.name);\n    });\n    this.plugin.setPluginState(_extends({}, state, {\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: sorting === 'titleDescending' ? 'titleAscending' : 'titleDescending'\n    }));\n  };\n\n  _proto.sortByDate = function sortByDate() {\n    var state = _extends({}, this.plugin.getPluginState());\n\n    var files = state.files,\n        folders = state.folders,\n        sorting = state.sorting;\n    var sortedFiles = files.sort(function (fileA, fileB) {\n      var a = new Date(fileA.modifiedDate);\n      var b = new Date(fileB.modifiedDate);\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0;\n      }\n\n      return a > b ? 1 : a < b ? -1 : 0;\n    });\n    var sortedFolders = folders.sort(function (folderA, folderB) {\n      var a = new Date(folderA.modifiedDate);\n      var b = new Date(folderB.modifiedDate);\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0;\n      }\n\n      return a > b ? 1 : a < b ? -1 : 0;\n    });\n    this.plugin.setPluginState(_extends({}, state, {\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: sorting === 'dateDescending' ? 'dateAscending' : 'dateDescending'\n    }));\n  };\n\n  _proto.sortBySize = function sortBySize() {\n    var state = _extends({}, this.plugin.getPluginState());\n\n    var files = state.files,\n        sorting = state.sorting; // check that plugin supports file sizes\n\n    if (!files.length || !this.plugin.getItemData(files[0]).size) {\n      return;\n    }\n\n    var sortedFiles = files.sort(function (fileA, fileB) {\n      var a = fileA.size;\n      var b = fileB.size;\n\n      if (sorting === 'sizeDescending') {\n        return a > b ? -1 : a < b ? 1 : 0;\n      }\n\n      return a > b ? 1 : a < b ? -1 : 0;\n    });\n    this.plugin.setPluginState(_extends({}, state, {\n      files: sortedFiles,\n      sorting: sorting === 'sizeDescending' ? 'sizeAscending' : 'sizeDescending'\n    }));\n  }\n  /**\n   * Adds all files found inside of specified folder.\n   *\n   * Uses separated state while folder contents are being fetched and\n   * mantains list of selected folders, which are separated from files.\n   */\n  ;\n\n  _proto.addFolder = function addFolder(folder) {\n    var _this3 = this;\n\n    var folderId = this.providerFileToId(folder);\n    var state = this.plugin.getPluginState();\n\n    var folders = _extends({}, state.selectedFolders);\n\n    if (folderId in folders && folders[folderId].loading) {\n      return;\n    }\n\n    folders[folderId] = {\n      loading: true,\n      files: []\n    };\n    this.plugin.setPluginState({\n      selectedFolders: _extends({}, folders)\n    });\n    return this.listAllFiles(folder.requestPath).then(function (files) {\n      var count = 0;\n      files.forEach(function (file) {\n        var success = _this3.addFile(file);\n\n        if (success) count++;\n      });\n      var ids = files.map(_this3.providerFileToId);\n      folders[folderId] = {\n        loading: false,\n        files: ids\n      };\n\n      _this3.plugin.setPluginState({\n        selectedFolders: folders\n      });\n\n      var message;\n\n      if (files.length) {\n        message = _this3.plugin.uppy.i18n('folderAdded', {\n          smart_count: count,\n          folder: folder.name\n        });\n      } else {\n        message = _this3.plugin.uppy.i18n('emptyFolderAdded');\n      }\n\n      _this3.plugin.uppy.info(message);\n    }).catch(function (e) {\n      var state = _this3.plugin.getPluginState();\n\n      var selectedFolders = _extends({}, state.selectedFolders);\n\n      delete selectedFolders[folderId];\n\n      _this3.plugin.setPluginState({\n        selectedFolders: selectedFolders\n      });\n\n      _this3.handleError(e);\n    });\n  };\n\n  _proto.providerFileToId = function providerFileToId(file) {\n    return generateFileID({\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType\n    });\n  };\n\n  _proto.handleAuth = function handleAuth() {\n    var _this4 = this;\n\n    var authState = btoa(JSON.stringify({\n      origin: getOrigin()\n    }));\n    var clientVersion = \"@uppy/provider-views=\" + ProviderView.VERSION;\n    var link = this.provider.authUrl({\n      state: authState,\n      uppyVersions: clientVersion\n    });\n    var authWindow = window.open(link, '_blank');\n\n    var handleToken = function handleToken(e) {\n      if (!_this4._isOriginAllowed(e.origin, _this4.plugin.opts.companionAllowedHosts) || e.source !== authWindow) {\n        _this4.plugin.uppy.log(\"rejecting event from \" + e.origin + \" vs allowed pattern \" + _this4.plugin.opts.companionAllowedHosts);\n\n        return;\n      } // Check if it's a string before doing the JSON.parse to maintain support\n      // for older Companion versions that used object references\n\n\n      var data = typeof e.data === 'string' ? JSON.parse(e.data) : e.data;\n\n      if (!data.token) {\n        _this4.plugin.uppy.log('did not receive token from auth window');\n\n        return;\n      }\n\n      authWindow.close();\n      window.removeEventListener('message', handleToken);\n\n      _this4.provider.setAuthToken(data.token);\n\n      _this4.preFirstRender();\n    };\n\n    window.addEventListener('message', handleToken);\n  };\n\n  _proto._isOriginAllowed = function _isOriginAllowed(origin, allowedOrigin) {\n    var getRegex = function getRegex(value) {\n      if (typeof value === 'string') {\n        return new RegExp(\"^\" + value + \"$\");\n      }\n\n      if (value instanceof RegExp) {\n        return value;\n      }\n    };\n\n    var patterns = Array.isArray(allowedOrigin) ? allowedOrigin.map(getRegex) : [getRegex(allowedOrigin)];\n    return patterns.filter(function (pattern) {\n      return pattern != null;\n    }) // loose comparison to catch undefined\n    .some(function (pattern) {\n      return pattern.test(origin) || pattern.test(origin + \"/\");\n    }); // allowing for trailing '/'\n  };\n\n  _proto.handleError = function handleError(error) {\n    var uppy = this.plugin.uppy;\n    uppy.log(error.toString());\n\n    if (error.isAuthError) {\n      return;\n    }\n\n    var message = uppy.i18n('companionError');\n    uppy.info({\n      message: message,\n      details: error.toString()\n    }, 'error', 5000);\n  };\n\n  _proto.handleScroll = function handleScroll(e) {\n    var _this5 = this;\n\n    var scrollPos = e.target.scrollHeight - (e.target.scrollTop + e.target.offsetHeight);\n    var path = this.nextPagePath || null;\n\n    if (scrollPos < 50 && path && !this._isHandlingScroll) {\n      this.provider.list(path).then(function (res) {\n        var _this5$plugin$getPlug = _this5.plugin.getPluginState(),\n            files = _this5$plugin$getPlug.files,\n            folders = _this5$plugin$getPlug.folders;\n\n        _this5._updateFilesAndFolders(res, files, folders);\n      }).catch(this.handleError).then(function () {\n        _this5._isHandlingScroll = false;\n      }); // always called\n\n      this._isHandlingScroll = true;\n    }\n  };\n\n  _proto.listAllFiles = function listAllFiles(path, files) {\n    var _this6 = this;\n\n    if (files === void 0) {\n      files = null;\n    }\n\n    files = files || [];\n    return new Promise(function (resolve, reject) {\n      _this6.provider.list(path).then(function (res) {\n        res.items.forEach(function (item) {\n          if (!item.isFolder) {\n            files.push(item);\n          } else {\n            _this6.addFolder(item);\n          }\n        });\n        var moreFiles = res.nextPagePath || null;\n\n        if (moreFiles) {\n          return _this6.listAllFiles(moreFiles, files).then(function (files) {\n            return resolve(files);\n          }).catch(function (e) {\n            return reject(e);\n          });\n        }\n\n        return resolve(files);\n      }).catch(function (e) {\n        return reject(e);\n      });\n    });\n  };\n\n  _proto.donePicking = function donePicking() {\n    var _this7 = this;\n\n    var _this$plugin$getPlugi = this.plugin.getPluginState(),\n        currentSelection = _this$plugin$getPlugi.currentSelection;\n\n    var promises = currentSelection.map(function (file) {\n      if (file.isFolder) {\n        return _this7.addFolder(file);\n      }\n\n      return _this7.addFile(file);\n    });\n\n    this._sharedHandler.loaderWrapper(Promise.all(promises), function () {\n      _this7.clearSelection();\n    }, function () {});\n  };\n\n  _proto.cancelPicking = function cancelPicking() {\n    this.clearSelection();\n    var dashboard = this.plugin.uppy.getPlugin('Dashboard');\n    if (dashboard) dashboard.hideAllPanels();\n  };\n\n  _proto.clearSelection = function clearSelection() {\n    this.plugin.setPluginState({\n      currentSelection: []\n    });\n  };\n\n  _proto.render = function render(state, viewOptions) {\n    if (viewOptions === void 0) {\n      viewOptions = {};\n    }\n\n    var _this$plugin$getPlugi2 = this.plugin.getPluginState(),\n        authenticated = _this$plugin$getPlugi2.authenticated,\n        didFirstRender = _this$plugin$getPlugi2.didFirstRender;\n\n    if (!didFirstRender) {\n      this.preFirstRender();\n    } // reload pluginState for \"loading\" attribute because it might\n    // have changed above.\n\n\n    if (this.plugin.getPluginState().loading) {\n      return h(CloseWrapper, {\n        onUnmount: this.clearSelection\n      }, h(LoaderView, {\n        i18n: this.plugin.uppy.i18n\n      }));\n    }\n\n    if (!authenticated) {\n      return h(CloseWrapper, {\n        onUnmount: this.clearSelection\n      }, h(AuthView, {\n        pluginName: this.plugin.title,\n        pluginIcon: this.plugin.icon,\n        handleAuth: this.handleAuth,\n        i18n: this.plugin.uppy.i18n,\n        i18nArray: this.plugin.uppy.i18nArray\n      }));\n    }\n\n    var targetViewOptions = _extends({}, this.opts, viewOptions);\n\n    var headerProps = {\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      getFolder: this.getFolder,\n      directories: this.plugin.getPluginState().directories,\n      pluginIcon: this.plugin.icon,\n      title: this.plugin.title,\n      logout: this.logout,\n      username: this.username,\n      i18n: this.plugin.uppy.i18n\n    };\n\n    var browserProps = _extends({}, this.plugin.getPluginState(), {\n      username: this.username,\n      getNextFolder: this.getNextFolder,\n      getFolder: this.getFolder,\n      filterItems: this._sharedHandler.filterItems,\n      filterQuery: this.filterQuery,\n      sortByTitle: this.sortByTitle,\n      sortByDate: this.sortByDate,\n      logout: this.logout,\n      isChecked: this._sharedHandler.isChecked,\n      toggleCheckbox: this._sharedHandler.toggleCheckbox,\n      handleScroll: this.handleScroll,\n      listAllFiles: this.listAllFiles,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      headerComponent: Header(headerProps),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: this.plugin.uppy.validateRestrictions\n    });\n\n    return h(CloseWrapper, {\n      onUnmount: this.clearSelection\n    }, h(Browser, browserProps));\n  };\n\n  return ProviderView;\n}(), _class.VERSION = \"1.12.2\", _temp);","map":{"version":3,"sources":["D:/TT18-EC-Team1-FE/isomorphic/node_modules/@uppy/provider-views/lib/ProviderView/ProviderView.js"],"names":["_class","_temp","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_require","require","h","AuthView","Header","Browser","LoaderView","generateFileID","getFileType","findIndex","isPreviewSupported","SharedHandler","CloseWrapper","getOrigin","location","origin","protocol","hostname","port","module","exports","ProviderView","plugin","opts","provider","_sharedHandler","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","addFile","bind","filterQuery","getFolder","getNextFolder","logout","preFirstRender","handleAuth","sortByTitle","sortByDate","handleError","handleScroll","listAllFiles","donePicking","cancelPicking","clearSelection","render","setPluginState","authenticated","files","folders","directories","filterInput","isSearchVisible","_proto","tearDown","_updateFilesAndFolders","res","nextPagePath","items","forEach","item","isFolder","push","didFirstRender","onFirstRender","id","name","_this","loaderWrapper","list","updatedDirectories","state","getPluginState","index","dir","slice","concat","title","username","folder","requestPath","lastCheckbox","undefined","file","tagFile","providerFileToId","data","type","mimeType","isRemote","body","fileId","remote","companionUrl","url","fileUrl","providerOptions","fileType","preview","thumbnail","uppy","log","err","isRestriction","_this2","then","ok","revoked","message","i18n","manual_revoke_url","info","newState","catch","e","value","sorting","sortedFiles","sort","fileA","fileB","localeCompare","sortedFolders","folderA","folderB","a","Date","modifiedDate","b","sortBySize","getItemData","size","addFolder","_this3","folderId","selectedFolders","loading","count","success","ids","map","smart_count","_this4","authState","btoa","JSON","stringify","clientVersion","VERSION","link","authUrl","uppyVersions","authWindow","window","open","handleToken","_isOriginAllowed","companionAllowedHosts","parse","token","close","removeEventListener","setAuthToken","addEventListener","allowedOrigin","getRegex","RegExp","patterns","Array","isArray","filter","pattern","some","test","error","toString","isAuthError","details","_this5","scrollPos","scrollHeight","scrollTop","offsetHeight","path","_isHandlingScroll","_this5$plugin$getPlug","_this6","Promise","resolve","reject","moreFiles","_this7","_this$plugin$getPlugi","currentSelection","promises","all","dashboard","getPlugin","hideAllPanels","viewOptions","_this$plugin$getPlugi2","onUnmount","pluginName","pluginIcon","icon","i18nArray","targetViewOptions","headerProps","browserProps","filterItems","isChecked","toggleCheckbox","done","cancel","headerComponent","uppyFiles","getFiles","validateRestrictions"],"mappings":"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","sourcesContent":["var _class, _temp;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nvar _require = require('preact'),\n    h = _require.h;\n\nvar AuthView = require('./AuthView');\n\nvar Header = require('./Header');\n\nvar Browser = require('../Browser');\n\nvar LoaderView = require('../Loader');\n\nvar generateFileID = require('@uppy/utils/lib/generateFileID');\n\nvar getFileType = require('@uppy/utils/lib/getFileType');\n\nvar findIndex = require('@uppy/utils/lib/findIndex');\n\nvar isPreviewSupported = require('@uppy/utils/lib/isPreviewSupported');\n\nvar SharedHandler = require('../SharedHandler');\n\nvar CloseWrapper = require('../CloseWrapper'); // location.origin does not exist in IE\n\n\nfunction getOrigin() {\n  if ('origin' in location) {\n    return location.origin; // eslint-disable-line compat/compat\n  }\n\n  return location.protocol + \"//\" + location.hostname + (location.port ? \":\" + location.port : '');\n}\n/**\n * Class to easily generate generic views for Provider plugins\n */\n\n\nmodule.exports = (_temp = _class = /*#__PURE__*/function () {\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  function ProviderView(plugin, opts) {\n    this.plugin = plugin;\n    this.provider = opts.provider;\n    this._sharedHandler = new SharedHandler(plugin); // set default options\n\n    var defaultOptions = {\n      viewType: 'list',\n      showTitles: true,\n      showFilter: true,\n      showBreadcrumbs: true\n    }; // merge default options with the ones set by user\n\n    this.opts = _extends({}, defaultOptions, opts); // Logic\n\n    this.addFile = this.addFile.bind(this);\n    this.filterQuery = this.filterQuery.bind(this);\n    this.getFolder = this.getFolder.bind(this);\n    this.getNextFolder = this.getNextFolder.bind(this);\n    this.logout = this.logout.bind(this);\n    this.preFirstRender = this.preFirstRender.bind(this);\n    this.handleAuth = this.handleAuth.bind(this);\n    this.sortByTitle = this.sortByTitle.bind(this);\n    this.sortByDate = this.sortByDate.bind(this);\n    this.handleError = this.handleError.bind(this);\n    this.handleScroll = this.handleScroll.bind(this);\n    this.listAllFiles = this.listAllFiles.bind(this);\n    this.donePicking = this.donePicking.bind(this);\n    this.cancelPicking = this.cancelPicking.bind(this);\n    this.clearSelection = this.clearSelection.bind(this); // Visual\n\n    this.render = this.render.bind(this);\n    this.clearSelection(); // Set default state for the plugin\n\n    this.plugin.setPluginState({\n      authenticated: false,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      isSearchVisible: false\n    });\n  }\n\n  var _proto = ProviderView.prototype;\n\n  _proto.tearDown = function tearDown() {// Nothing.\n  };\n\n  _proto._updateFilesAndFolders = function _updateFilesAndFolders(res, files, folders) {\n    this.nextPagePath = res.nextPagePath;\n    res.items.forEach(function (item) {\n      if (item.isFolder) {\n        folders.push(item);\n      } else {\n        files.push(item);\n      }\n    });\n    this.plugin.setPluginState({\n      folders: folders,\n      files: files\n    });\n  }\n  /**\n   * Called only the first time the provider view is rendered.\n   * Kind of like an init function.\n   */\n  ;\n\n  _proto.preFirstRender = function preFirstRender() {\n    this.plugin.setPluginState({\n      didFirstRender: true\n    });\n    this.plugin.onFirstRender();\n  }\n  /**\n   * Based on folder ID, fetch a new folder and update it to state\n   *\n   * @param  {string} id Folder id\n   * @returns {Promise}   Folders/files in folder\n   */\n  ;\n\n  _proto.getFolder = function getFolder(id, name) {\n    var _this = this;\n\n    return this._sharedHandler.loaderWrapper(this.provider.list(id), function (res) {\n      var folders = [];\n      var files = [];\n      var updatedDirectories;\n\n      var state = _this.plugin.getPluginState();\n\n      var index = findIndex(state.directories, function (dir) {\n        return id === dir.id;\n      });\n\n      if (index !== -1) {\n        updatedDirectories = state.directories.slice(0, index + 1);\n      } else {\n        updatedDirectories = state.directories.concat([{\n          id: id,\n          title: name\n        }]);\n      }\n\n      _this.username = res.username || _this.username;\n\n      _this._updateFilesAndFolders(res, files, folders);\n\n      _this.plugin.setPluginState({\n        directories: updatedDirectories\n      });\n    }, this.handleError);\n  }\n  /**\n   * Fetches new folder\n   *\n   * @param  {object} folder\n   */\n  ;\n\n  _proto.getNextFolder = function getNextFolder(folder) {\n    this.getFolder(folder.requestPath, folder.name);\n    this.lastCheckbox = undefined;\n  };\n\n  _proto.addFile = function addFile(file) {\n    var tagFile = {\n      id: this.providerFileToId(file),\n      source: this.plugin.id,\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType,\n      isRemote: true,\n      body: {\n        fileId: file.id\n      },\n      remote: {\n        companionUrl: this.plugin.opts.companionUrl,\n        url: \"\" + this.provider.fileUrl(file.requestPath),\n        body: {\n          fileId: file.id\n        },\n        providerOptions: this.provider.opts\n      }\n    };\n    var fileType = getFileType(tagFile); // TODO Should we just always use the thumbnail URL if it exists?\n\n    if (fileType && isPreviewSupported(fileType)) {\n      tagFile.preview = file.thumbnail;\n    }\n\n    this.plugin.uppy.log('Adding remote file');\n\n    try {\n      this.plugin.uppy.addFile(tagFile);\n      return true;\n    } catch (err) {\n      if (!err.isRestriction) {\n        this.plugin.uppy.log(err);\n      }\n\n      return false;\n    }\n  }\n  /**\n   * Removes session token on client side.\n   */\n  ;\n\n  _proto.logout = function logout() {\n    var _this2 = this;\n\n    this.provider.logout().then(function (res) {\n      if (res.ok) {\n        if (!res.revoked) {\n          var message = _this2.plugin.uppy.i18n('companionUnauthorizeHint', {\n            provider: _this2.plugin.title,\n            url: res.manual_revoke_url\n          });\n\n          _this2.plugin.uppy.info(message, 'info', 7000);\n        }\n\n        var newState = {\n          authenticated: false,\n          files: [],\n          folders: [],\n          directories: []\n        };\n\n        _this2.plugin.setPluginState(newState);\n      }\n    }).catch(this.handleError);\n  };\n\n  _proto.filterQuery = function filterQuery(e) {\n    var state = this.plugin.getPluginState();\n    this.plugin.setPluginState(_extends({}, state, {\n      filterInput: e ? e.target.value : ''\n    }));\n  };\n\n  _proto.sortByTitle = function sortByTitle() {\n    var state = _extends({}, this.plugin.getPluginState());\n\n    var files = state.files,\n        folders = state.folders,\n        sorting = state.sorting;\n    var sortedFiles = files.sort(function (fileA, fileB) {\n      if (sorting === 'titleDescending') {\n        return fileB.name.localeCompare(fileA.name);\n      }\n\n      return fileA.name.localeCompare(fileB.name);\n    });\n    var sortedFolders = folders.sort(function (folderA, folderB) {\n      if (sorting === 'titleDescending') {\n        return folderB.name.localeCompare(folderA.name);\n      }\n\n      return folderA.name.localeCompare(folderB.name);\n    });\n    this.plugin.setPluginState(_extends({}, state, {\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: sorting === 'titleDescending' ? 'titleAscending' : 'titleDescending'\n    }));\n  };\n\n  _proto.sortByDate = function sortByDate() {\n    var state = _extends({}, this.plugin.getPluginState());\n\n    var files = state.files,\n        folders = state.folders,\n        sorting = state.sorting;\n    var sortedFiles = files.sort(function (fileA, fileB) {\n      var a = new Date(fileA.modifiedDate);\n      var b = new Date(fileB.modifiedDate);\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0;\n      }\n\n      return a > b ? 1 : a < b ? -1 : 0;\n    });\n    var sortedFolders = folders.sort(function (folderA, folderB) {\n      var a = new Date(folderA.modifiedDate);\n      var b = new Date(folderB.modifiedDate);\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0;\n      }\n\n      return a > b ? 1 : a < b ? -1 : 0;\n    });\n    this.plugin.setPluginState(_extends({}, state, {\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: sorting === 'dateDescending' ? 'dateAscending' : 'dateDescending'\n    }));\n  };\n\n  _proto.sortBySize = function sortBySize() {\n    var state = _extends({}, this.plugin.getPluginState());\n\n    var files = state.files,\n        sorting = state.sorting; // check that plugin supports file sizes\n\n    if (!files.length || !this.plugin.getItemData(files[0]).size) {\n      return;\n    }\n\n    var sortedFiles = files.sort(function (fileA, fileB) {\n      var a = fileA.size;\n      var b = fileB.size;\n\n      if (sorting === 'sizeDescending') {\n        return a > b ? -1 : a < b ? 1 : 0;\n      }\n\n      return a > b ? 1 : a < b ? -1 : 0;\n    });\n    this.plugin.setPluginState(_extends({}, state, {\n      files: sortedFiles,\n      sorting: sorting === 'sizeDescending' ? 'sizeAscending' : 'sizeDescending'\n    }));\n  }\n  /**\n   * Adds all files found inside of specified folder.\n   *\n   * Uses separated state while folder contents are being fetched and\n   * mantains list of selected folders, which are separated from files.\n   */\n  ;\n\n  _proto.addFolder = function addFolder(folder) {\n    var _this3 = this;\n\n    var folderId = this.providerFileToId(folder);\n    var state = this.plugin.getPluginState();\n\n    var folders = _extends({}, state.selectedFolders);\n\n    if (folderId in folders && folders[folderId].loading) {\n      return;\n    }\n\n    folders[folderId] = {\n      loading: true,\n      files: []\n    };\n    this.plugin.setPluginState({\n      selectedFolders: _extends({}, folders)\n    });\n    return this.listAllFiles(folder.requestPath).then(function (files) {\n      var count = 0;\n      files.forEach(function (file) {\n        var success = _this3.addFile(file);\n\n        if (success) count++;\n      });\n      var ids = files.map(_this3.providerFileToId);\n      folders[folderId] = {\n        loading: false,\n        files: ids\n      };\n\n      _this3.plugin.setPluginState({\n        selectedFolders: folders\n      });\n\n      var message;\n\n      if (files.length) {\n        message = _this3.plugin.uppy.i18n('folderAdded', {\n          smart_count: count,\n          folder: folder.name\n        });\n      } else {\n        message = _this3.plugin.uppy.i18n('emptyFolderAdded');\n      }\n\n      _this3.plugin.uppy.info(message);\n    }).catch(function (e) {\n      var state = _this3.plugin.getPluginState();\n\n      var selectedFolders = _extends({}, state.selectedFolders);\n\n      delete selectedFolders[folderId];\n\n      _this3.plugin.setPluginState({\n        selectedFolders: selectedFolders\n      });\n\n      _this3.handleError(e);\n    });\n  };\n\n  _proto.providerFileToId = function providerFileToId(file) {\n    return generateFileID({\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType\n    });\n  };\n\n  _proto.handleAuth = function handleAuth() {\n    var _this4 = this;\n\n    var authState = btoa(JSON.stringify({\n      origin: getOrigin()\n    }));\n    var clientVersion = \"@uppy/provider-views=\" + ProviderView.VERSION;\n    var link = this.provider.authUrl({\n      state: authState,\n      uppyVersions: clientVersion\n    });\n    var authWindow = window.open(link, '_blank');\n\n    var handleToken = function handleToken(e) {\n      if (!_this4._isOriginAllowed(e.origin, _this4.plugin.opts.companionAllowedHosts) || e.source !== authWindow) {\n        _this4.plugin.uppy.log(\"rejecting event from \" + e.origin + \" vs allowed pattern \" + _this4.plugin.opts.companionAllowedHosts);\n\n        return;\n      } // Check if it's a string before doing the JSON.parse to maintain support\n      // for older Companion versions that used object references\n\n\n      var data = typeof e.data === 'string' ? JSON.parse(e.data) : e.data;\n\n      if (!data.token) {\n        _this4.plugin.uppy.log('did not receive token from auth window');\n\n        return;\n      }\n\n      authWindow.close();\n      window.removeEventListener('message', handleToken);\n\n      _this4.provider.setAuthToken(data.token);\n\n      _this4.preFirstRender();\n    };\n\n    window.addEventListener('message', handleToken);\n  };\n\n  _proto._isOriginAllowed = function _isOriginAllowed(origin, allowedOrigin) {\n    var getRegex = function getRegex(value) {\n      if (typeof value === 'string') {\n        return new RegExp(\"^\" + value + \"$\");\n      }\n\n      if (value instanceof RegExp) {\n        return value;\n      }\n    };\n\n    var patterns = Array.isArray(allowedOrigin) ? allowedOrigin.map(getRegex) : [getRegex(allowedOrigin)];\n    return patterns.filter(function (pattern) {\n      return pattern != null;\n    }) // loose comparison to catch undefined\n    .some(function (pattern) {\n      return pattern.test(origin) || pattern.test(origin + \"/\");\n    }); // allowing for trailing '/'\n  };\n\n  _proto.handleError = function handleError(error) {\n    var uppy = this.plugin.uppy;\n    uppy.log(error.toString());\n\n    if (error.isAuthError) {\n      return;\n    }\n\n    var message = uppy.i18n('companionError');\n    uppy.info({\n      message: message,\n      details: error.toString()\n    }, 'error', 5000);\n  };\n\n  _proto.handleScroll = function handleScroll(e) {\n    var _this5 = this;\n\n    var scrollPos = e.target.scrollHeight - (e.target.scrollTop + e.target.offsetHeight);\n    var path = this.nextPagePath || null;\n\n    if (scrollPos < 50 && path && !this._isHandlingScroll) {\n      this.provider.list(path).then(function (res) {\n        var _this5$plugin$getPlug = _this5.plugin.getPluginState(),\n            files = _this5$plugin$getPlug.files,\n            folders = _this5$plugin$getPlug.folders;\n\n        _this5._updateFilesAndFolders(res, files, folders);\n      }).catch(this.handleError).then(function () {\n        _this5._isHandlingScroll = false;\n      }); // always called\n\n      this._isHandlingScroll = true;\n    }\n  };\n\n  _proto.listAllFiles = function listAllFiles(path, files) {\n    var _this6 = this;\n\n    if (files === void 0) {\n      files = null;\n    }\n\n    files = files || [];\n    return new Promise(function (resolve, reject) {\n      _this6.provider.list(path).then(function (res) {\n        res.items.forEach(function (item) {\n          if (!item.isFolder) {\n            files.push(item);\n          } else {\n            _this6.addFolder(item);\n          }\n        });\n        var moreFiles = res.nextPagePath || null;\n\n        if (moreFiles) {\n          return _this6.listAllFiles(moreFiles, files).then(function (files) {\n            return resolve(files);\n          }).catch(function (e) {\n            return reject(e);\n          });\n        }\n\n        return resolve(files);\n      }).catch(function (e) {\n        return reject(e);\n      });\n    });\n  };\n\n  _proto.donePicking = function donePicking() {\n    var _this7 = this;\n\n    var _this$plugin$getPlugi = this.plugin.getPluginState(),\n        currentSelection = _this$plugin$getPlugi.currentSelection;\n\n    var promises = currentSelection.map(function (file) {\n      if (file.isFolder) {\n        return _this7.addFolder(file);\n      }\n\n      return _this7.addFile(file);\n    });\n\n    this._sharedHandler.loaderWrapper(Promise.all(promises), function () {\n      _this7.clearSelection();\n    }, function () {});\n  };\n\n  _proto.cancelPicking = function cancelPicking() {\n    this.clearSelection();\n    var dashboard = this.plugin.uppy.getPlugin('Dashboard');\n    if (dashboard) dashboard.hideAllPanels();\n  };\n\n  _proto.clearSelection = function clearSelection() {\n    this.plugin.setPluginState({\n      currentSelection: []\n    });\n  };\n\n  _proto.render = function render(state, viewOptions) {\n    if (viewOptions === void 0) {\n      viewOptions = {};\n    }\n\n    var _this$plugin$getPlugi2 = this.plugin.getPluginState(),\n        authenticated = _this$plugin$getPlugi2.authenticated,\n        didFirstRender = _this$plugin$getPlugi2.didFirstRender;\n\n    if (!didFirstRender) {\n      this.preFirstRender();\n    } // reload pluginState for \"loading\" attribute because it might\n    // have changed above.\n\n\n    if (this.plugin.getPluginState().loading) {\n      return h(CloseWrapper, {\n        onUnmount: this.clearSelection\n      }, h(LoaderView, {\n        i18n: this.plugin.uppy.i18n\n      }));\n    }\n\n    if (!authenticated) {\n      return h(CloseWrapper, {\n        onUnmount: this.clearSelection\n      }, h(AuthView, {\n        pluginName: this.plugin.title,\n        pluginIcon: this.plugin.icon,\n        handleAuth: this.handleAuth,\n        i18n: this.plugin.uppy.i18n,\n        i18nArray: this.plugin.uppy.i18nArray\n      }));\n    }\n\n    var targetViewOptions = _extends({}, this.opts, viewOptions);\n\n    var headerProps = {\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      getFolder: this.getFolder,\n      directories: this.plugin.getPluginState().directories,\n      pluginIcon: this.plugin.icon,\n      title: this.plugin.title,\n      logout: this.logout,\n      username: this.username,\n      i18n: this.plugin.uppy.i18n\n    };\n\n    var browserProps = _extends({}, this.plugin.getPluginState(), {\n      username: this.username,\n      getNextFolder: this.getNextFolder,\n      getFolder: this.getFolder,\n      filterItems: this._sharedHandler.filterItems,\n      filterQuery: this.filterQuery,\n      sortByTitle: this.sortByTitle,\n      sortByDate: this.sortByDate,\n      logout: this.logout,\n      isChecked: this._sharedHandler.isChecked,\n      toggleCheckbox: this._sharedHandler.toggleCheckbox,\n      handleScroll: this.handleScroll,\n      listAllFiles: this.listAllFiles,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      headerComponent: Header(headerProps),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: this.plugin.uppy.validateRestrictions\n    });\n\n    return h(CloseWrapper, {\n      onUnmount: this.clearSelection\n    }, h(Browser, browserProps));\n  };\n\n  return ProviderView;\n}(), _class.VERSION = \"1.12.2\", _temp);"]},"metadata":{},"sourceType":"script"}